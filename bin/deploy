#!/bin/bash

export $(echo $(cat .env | sed 's/#.*//g' | sed 's/\r//g' | xargs) | envsubst)

ssh "$REMOTE_USER"@"$REMOTE_HOST" "mkdir -p $REMOTE_PATH"

# shellcheck disable=SC2046
rsync -var --delete --exclude 'build' --exclude '.git' --exclude '.idea' --exclude '.env' . "$REMOTE_USER"@"$REMOTE_HOST":"$REMOTE_PATH"

ssh "$REMOTE_USER"@"$REMOTE_HOST" "cd $REMOTE_PATH && bin/remote/buildAndUpdate"
